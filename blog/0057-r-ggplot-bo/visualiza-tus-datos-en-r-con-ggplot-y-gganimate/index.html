<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Visualiza tus datos en R con ggplot2 y gganimate | Open Science Labs</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="es" href="../../../rss.xml">
<link rel="canonical" href="https://opensciencelabs.org/blog/0057-r-ggplot-bo/visualiza-tus-datos-en-r-con-ggplot-y-gganimate/">
<link rel="icon" href="../../../images/favicon.ico" sizes="16x16">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-213158050-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-213158050-1');
</script><link rel="stylesheet" type="text/css" href="../../../assets/css/tipuesearch.css">
<meta name="author" content="Ever Vino">
<meta property="description" content="Una gráfica es una buena manera de expresar los datos, estos ayudan a ver detalles que simplemente pueden pasar desapercibidos cuando sólo se los analizan numericamente, estos pueden tener aún mayor i">
<link rel="prev" href="../../0058-nfts-article1/nft-mas-que-un-jpg/" title="NFT. Más que un JPG" type="text/html">
<link rel="next" href="../../0001-ciencia_abierta/que-es-la-ciencia-abierta/" title="¿Qué es la ciencia abierta?" type="text/html">
<link rel="stylesheet" href="https://use.fontawesome.com/aa402b3835.css">
<meta property="og:site_name" content="Open Science Labs">
<meta property="og:title" content="Visualiza tus datos en R con ggplot2 y gganimate">
<meta property="og:url" content="https://opensciencelabs.org/blog/0057-r-ggplot-bo/visualiza-tus-datos-en-r-con-ggplot-y-gganimate/">
<meta property="og:description" content="Una gráfica es una buena manera de expresar los datos, estos ayudan a ver detalles que simplemente pueden pasar desapercibidos cuando sólo se los analizan numericamente, estos pueden tener aún mayor i">
<meta property="og:image" content="https://opensciencelabs.org/images/logo.jpg">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-04-08T00:00:00-05:00">
<meta property="article:tag" content="r">
<meta property="article:tag" content="visualization">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@opensciencelabs">
<meta property="twitter:image" content="https://opensciencelabs.org/images/logo.jpg">
<link rel="stylesheet" href="../../../assets/css/osl.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../../">
            <img src="../../../images/logo.png" alt="Open Science Labs" id="logo" class="d-inline-block align-top"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../../" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="../../" class="nav-link">Blog</a>
                </li>
<li class="nav-item">
<a href="../../../guidelines/list" class="nav-link">Guidelines</a>
                </li>
<li class="nav-item">
<a href="../../../team/" class="nav-link">Team</a>
                </li>
<li class="nav-item">
<a href="../../../about/" class="nav-link">About</a>

                
            </li>
</ul>
<form class="navbar-form navbar-left" action="../../../search" role="search">
    <div class="form-group">
        <input type="text" class="form-control" id="tipue_search_input" name="q" placeholder="Search…" autocomplete="off">
</div>
    <input type="submit" value="Local Search" style="visibility: hidden;"><!-- button type="submit" class="btn btn-default">Submit</button -->
</form>


            <ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name">
                <a href="." class="u-url">Visualiza tus datos en R con ggplot2 y gganimate</a>
            </h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                         <a class="u-url" href="../../../authors/ever-vino/">Ever Vino</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-04-08T00:00:00-05:00" itemprop="datePublished" title="2019-04-08">2019-04-08</time></a>
            </p>
                <p class="commentline">
    
    <a href="#disqus_thread" data-disqus-identifier="cache/pages/blog/0057-r-ggplot-bo/ArticuloGgplotenR.html">Comentarios</a>


            

        </p>
</div>
        
        <ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/r/" rel="tag">r</a></li>
            <li><a class="tag p-category" href="../../../categories/visualization/" rel="tag">visualization</a></li>
        </ul></header><div class="e-content entry-content" itemprop="articleBody text">
        <!-- # Visualiza tus datos en R con ggplot2 y gganimate -->
<!-- **Autor**: [Ever Vino](../../authors/ever-vino.md) -->

<p><img alt="header" src="../../../images/blog/visualiza-tus-datos-en-r-con-ggplot-y-gganimate/header.png"></p>
<p>Una gráfica es una buena manera de expresar los datos, estos ayudan a ver detalles que simplemente pueden pasar desapercibidos cuando sólo se los analizan numericamente, estos pueden tener aún mayor impacto si estan animados. ¿Por qué no hacerlo?. En este artículo se describe como hacer animación usando ggplot2 y gganimate en R.</p>
<!-- TEASER_END -->

<h3>Comenzando</h3>
<p>Usamos R por ser un lenguaje especializado para ciencia de datos y tener una gran Comunidad Open Source. Antes de comenzar recomendamos tener las versiones actualizadas de R y su IDE RStudio.</p>
<p><em>Puedes descargar R y RStudio desde sus páginas web oficiales:</em></p>
<p><a href="https://cran.r-project.org/">cran.r-project.org</a></p>
<p><a href="https://www.rstudio.com/">rstudio.org</a></p>
<h4>Instalación de pre-requisitos</h4>
<p>Para este ejemplo usamos las bibliotecas de <code>rio</code>, <code>dplyr</code>, <code>ggplot2</code> y <code>gganimate</code>. Las instalamos con los siguientes comandos en R
<em>(Recuerde que para ejecutar una linea de Comando en el Editor de RStudio Es con Ctrl+Enter o puede escribirlo directamento en la Consola)</em></p>
<pre class="code literal-block"><span></span><code><span class="nf">install.package</span><span class="p">(</span><span class="n">rio</span><span class="p">)</span>        <span class="c1"># Biblioteca para importar archivos csv o xlsx</span>
<span class="nf">install.package</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>      <span class="c1"># Biblioteca para filtrar datos</span>
<span class="nf">install.package</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>    <span class="c1"># Biblioteca para realizar las gráficas</span>
<span class="nf">install.package</span><span class="p">(</span><span class="n">gganimate</span><span class="p">)</span>  <span class="c1"># Biblioteca para realizar la animación</span>
</code></pre>

<h3>Preparación de los datos para graficar</h3>
<p>Los datos usados pertenecen a la base de datos del INE <a href="https://www.ine.gob.bo">(Instituto Nacional de Estadística Bolivia)</a>, el archivo usado tiene el nombre de "Importaciones de Productos y Artículos de Bolivia 1992-2021p"</p>
<p>Abrimos nuestras bibliotecas:</p>
<pre class="code literal-block"><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">rio</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">gganimate</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
</code></pre>

<p>Importamos los datos a un objeto llamado <code>libro</code> con:</p>
<pre class="code literal-block"><span></span><code><span class="n">libro</span> <span class="o">&lt;-</span> <span class="nf">import</span><span class="p">(</span><span class="s">".my/path/DatosImportacionBolivia1992-2021.csv"</span><span class="p">)</span>
</code></pre>

<p>Para ver la cabecera del libro, y para ver la estructura del <code>libro</code> ejecutamos respectivamente <code>head(libro)</code> y <code>str(libro)</code>.</p>
<pre class="code literal-block"><span></span><code><span class="o">&gt;</span> <span class="nf">head</span><span class="p">(</span><span class="n">libro</span><span class="p">)</span>
       <span class="n">Fecha</span> <span class="n">ALIMENTOS</span> <span class="n">Y</span> <span class="n">BEBIDAS</span> <span class="n">SUMINISTROS</span> <span class="n">INDUSTRIALES</span> <span class="n">COMBUSTIBLES</span> <span class="n">Y</span> <span class="n">LUBRICANTES</span>
<span class="m">1</span> <span class="m">1992-01-01</span>           <span class="m">12.686477</span>                 <span class="m">30.38827</span>                   <span class="m">1.738607</span>
<span class="m">2</span> <span class="m">1992-02-01</span>            <span class="m">9.139570</span>                 <span class="m">32.57593</span>                   <span class="m">1.822906</span>
<span class="m">3</span> <span class="m">1992-03-01</span>            <span class="m">6.150201</span>                 <span class="m">21.37546</span>                   <span class="m">2.000110</span>
<span class="m">4</span> <span class="m">1992-04-01</span>            <span class="m">9.225652</span>                 <span class="m">28.34524</span>                   <span class="m">1.455245</span>
<span class="m">5</span> <span class="m">1992-05-01</span>           <span class="m">14.503611</span>                 <span class="m">22.06801</span>                   <span class="m">2.168646</span>
<span class="m">6</span> <span class="m">1992-06-01</span>            <span class="m">5.875804</span>                 <span class="m">25.43617</span>                   <span class="m">3.084602</span>
  <span class="n">BIENES</span> <span class="n">DE</span> <span class="n">CAPITAL</span> <span class="n">EQUIPO</span> <span class="n">DE</span> <span class="n">TRANSPORTE</span> <span class="n">Y</span> <span class="n">SUS</span> <span class="n">PIEZAS</span> <span class="n">Y</span> <span class="n">ACCESORIOS</span> <span class="n">ARTÍCULOS</span> <span class="n">DE</span> <span class="n">CONSUMO</span>
<span class="m">1</span>          <span class="m">25.66374</span>                                       <span class="m">22.20454</span>             <span class="m">5.585219</span>
<span class="m">2</span>          <span class="m">22.00027</span>                                       <span class="m">18.68626</span>             <span class="m">6.528652</span>
<span class="m">3</span>          <span class="m">22.92478</span>                                       <span class="m">17.40578</span>             <span class="m">6.196415</span>
<span class="m">4</span>          <span class="m">31.14429</span>                                       <span class="m">16.77957</span>             <span class="m">5.422824</span>
<span class="m">5</span>          <span class="m">26.82719</span>                                       <span class="m">22.79343</span>             <span class="m">5.458318</span>
<span class="m">6</span>          <span class="m">23.47011</span>                                       <span class="m">16.00698</span>             <span class="m">5.647866</span>_
</code></pre>

<pre class="code literal-block"><span></span><code><span class="o">&gt;</span> <span class="nf">str</span><span class="p">(</span><span class="n">libro</span><span class="p">)</span>
<span class="s">'data.frame'</span><span class="o">:</span>   <span class="m">358</span> <span class="n">obs.</span> <span class="n">of</span>  <span class="m">7</span> <span class="n">variables</span><span class="o">:</span>
 <span class="o">$</span> <span class="n">Fecha</span>                                         <span class="o">:</span> <span class="n">IDate</span><span class="p">,</span> <span class="n">format</span><span class="o">:</span> <span class="s">"1992-01-01"</span> <span class="s">"1992-02-01"</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">ALIMENTOS</span> <span class="n">Y</span> <span class="n">BEBIDAS</span>                           <span class="o">:</span> <span class="n">num</span>  <span class="m">12.69</span> <span class="m">9.14</span> <span class="m">6.15</span> <span class="m">9.23</span> <span class="m">14.5</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">SUMINISTROS</span> <span class="n">INDUSTRIALES</span>                      <span class="o">:</span> <span class="n">num</span>  <span class="m">30.4</span> <span class="m">32.6</span> <span class="m">21.4</span> <span class="m">28.3</span> <span class="m">22.1</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">COMBUSTIBLES</span> <span class="n">Y</span> <span class="n">LUBRICANTES</span>                    <span class="o">:</span> <span class="n">num</span>  <span class="m">1.74</span> <span class="m">1.82</span> <span class="m">2</span> <span class="m">1.46</span> <span class="m">2.17</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">BIENES</span> <span class="n">DE</span> <span class="n">CAPITAL</span>                             <span class="o">:</span> <span class="n">num</span>  <span class="m">25.7</span> <span class="m">22</span> <span class="m">22.9</span> <span class="m">31.1</span> <span class="m">26.8</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">EQUIPO</span> <span class="n">DE</span> <span class="n">TRANSPORTE</span> <span class="n">Y</span> <span class="n">SUS</span> <span class="n">PIEZAS</span> <span class="n">Y</span> <span class="n">ACCESORIOS</span><span class="o">:</span> <span class="n">num</span>  <span class="m">22.2</span> <span class="m">18.7</span> <span class="m">17.4</span> <span class="m">16.8</span> <span class="m">22.8</span> <span class="kc">...</span>
 <span class="o">$</span> <span class="n">ARTÍCULOS</span> <span class="n">DE</span> <span class="n">CONSUMO</span>                          <span class="o">:</span> <span class="n">num</span>  <span class="m">5.59</span> <span class="m">6.53</span> <span class="m">6.2</span> <span class="m">5.42</span> <span class="m">5.46</span> <span class="kc">...</span>
</code></pre>

<p>Es importante verificar el tipo de dato, antes de graficar, en este caso nos importa que la fecha tenga formato de <code>IDate</code> y los demás sean tengan formato de <code>num</code>. En caso de que la fecha no tenga formato <code>IDate</code> puedo tranformar la columna usando la el comando <code>columna&lt;-as.Date(columna)</code>.</p>
<p>Con las siguientes líneas de código, compactamos el número de columnas de nuestro <code>libro</code> en un nuevo objeto llamado <code>datos</code>. <em>(Notese que solamente utilizaremos las primeras 4 columnas del objeto libro).</em> Es decir una columna para la fecha, una columna para su valor y otra columna que muestre su clasificación.</p>
<pre class="code literal-block"><span></span><code><span class="c1"># Simplificando nuestra tabla para realizar las gráficas</span>
<span class="c1"># Cuando se escribe el nombre del objeto libro$.. en RStudio el autocomplado con los nombres de la columnas del libro</span>
<span class="n">datos</span> <span class="o">&lt;-</span>
  <span class="nf">data.frame</span><span class="p">(</span>
    <span class="n">Fecha</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="n">libro</span><span class="o">$</span><span class="n">Fecha</span><span class="p">,</span> <span class="n">libro</span><span class="o">$</span><span class="n">Fecha</span><span class="p">,</span> <span class="n">libro</span><span class="o">$</span><span class="n">Fecha</span><span class="p">,</span> <span class="n">libro</span><span class="o">$</span><span class="n">Fecha</span><span class="p">),</span>
    <span class="n">Valor</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span>
      <span class="n">libro</span><span class="o">$</span><span class="n">`ALIMENTOS Y BEBIDAS`</span><span class="p">,</span>
      <span class="n">libro</span><span class="o">$</span><span class="n">`SUMINISTROS INDUSTRIALES`</span><span class="p">,</span>
      <span class="n">libro</span><span class="o">$</span><span class="n">`COMBUSTIBLES Y LUBRICANTES`</span><span class="p">,</span>
      <span class="n">libro</span><span class="o">$</span><span class="n">`EQUIPO DE TRANSPORTE Y SUS PIEZAS Y ACCESORIOS`</span>
    <span class="p">),</span>
    <span class="n">Clasificacion</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span>
      <span class="nf">rep</span><span class="p">(</span><span class="s">"Alimentos y Bebidas"</span><span class="p">,</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">libro</span><span class="p">)),</span>
      <span class="nf">rep</span><span class="p">(</span><span class="s">"Suministros Industriales"</span><span class="p">,</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">libro</span><span class="p">)),</span>
      <span class="nf">rep</span><span class="p">(</span><span class="s">"Combustibles y Lubricantes"</span><span class="p">,</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">libro</span><span class="p">)),</span>
      <span class="nf">rep</span><span class="p">(</span><span class="s">"Equipo de Transporte"</span><span class="p">,</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">libro</span><span class="p">)</span>
      <span class="p">)</span>
</code></pre>

<p>Funciones auxiliares usadas:</p>
<ul>
<li>
<p><strong><code>libro$columna</code></strong>: para acceder al <code>columna</code> del <code>libro</code>.</p>
</li>
<li>
<p><strong><code>data.frame(columna1, columna2 ...)</code></strong>: para crear una nuevo <code>objeto de Datos</code>.</p>
</li>
<li>
<p><strong><code>c(elemento1, elemento2, ...)</code></strong>: para juntar <code>elementos</code> en un vector.</p>
</li>
<li>
<p><strong><code>rep(elemento, n_veces)</code></strong>: para generar un vector con el <code>elemento</code> repetido <code>n_veces</code>.</p>
</li>
<li>
<p><strong><code>nrow(tabla)</code></strong>: para obtener el número de filas de tabla.</p>
</li>
</ul>
<p>Observemos la cabecera de <code>datos</code> para verificar, con <code>head(datos)</code> :</p>
<pre class="code literal-block"><span></span><code><span class="o">&gt;</span> <span class="nf">head</span><span class="p">(</span><span class="n">datos</span><span class="p">)</span>
       <span class="n">Fecha</span>    <span class="n">Valor</span>       <span class="n">Clasificacion</span>
<span class="m">1</span> <span class="m">2018-01-01</span> <span class="m">56.34888</span> <span class="n">Alimentos</span> <span class="n">y</span> <span class="n">Bebidas</span>
<span class="m">2</span> <span class="m">2018-02-01</span> <span class="m">47.42231</span> <span class="n">Alimentos</span> <span class="n">y</span> <span class="n">Bebidas</span>
<span class="m">3</span> <span class="m">2018-03-01</span> <span class="m">59.54501</span> <span class="n">Alimentos</span> <span class="n">y</span> <span class="n">Bebidas</span>
<span class="m">4</span> <span class="m">2018-04-01</span> <span class="m">56.08808</span> <span class="n">Alimentos</span> <span class="n">y</span> <span class="n">Bebidas</span>
<span class="m">5</span> <span class="m">2018-05-01</span> <span class="m">51.86330</span> <span class="n">Alimentos</span> <span class="n">y</span> <span class="n">Bebidas</span>
<span class="m">6</span> <span class="m">2018-06-01</span> <span class="m">43.84668</span> <span class="n">Alimentos</span> <span class="n">y</span> <span class="n">Bebidas</span>
</code></pre>

<h3>Gráfica estática</h3>
<p>Para graficar con <code>ggplot2</code>, es conveniente entender que esta biblioteca añade sus componentes en layers (capas), estos layers son objetos a los cuales se le puede modificar su apariencia y especificar de donde extraer sus valores.</p>
<p>Asignamos a un objeto ggplot llamado p1 lo que vamos a graficar:</p>
<pre class="code literal-block"><span></span><code><span class="c1"># Modificando el theme a uno con el fondo blanco</span>
<span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_bw</span><span class="p">())</span>

<span class="n">p1</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">datos</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">Fecha</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Valor</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">Clasificacion</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">"right"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">"Fecha"</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s">"Valor en MM Bs"</span><span class="p">,</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s">""</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">"Datos de Importación de Bolivia 1991-2021p"</span><span class="p">,</span>
    <span class="n">subtitle</span> <span class="o">=</span> <span class="s">"Expresado en Millones de Bolivianos"</span>
  <span class="p">)</span>
<span class="n">p1</span>
</code></pre>

<p>Funciones utilizadas</p>
<ul>
<li>
<p><strong><code>theme_set(theme_bw())</code></strong>:
  modifica el conjunto de colores usado en el tema para realizar la gráfica.</p>
</li>
<li>
<p><strong><code>ggplot(data)</code></strong>: esta es la primera capa a utilizarse inicialmente le asignamos nuestos datos <code>data</code> para que cree las dimensiones de las coordenadas y esta se herede a las otras capas.</p>
</li>
<li>
<p><strong><code>geom_line(aes(x, y, color), size)</code></strong>: capa que hereda los datos de <code>ggplot()</code>, se los puede usar  directamente con el nombre de sus columnas, grafica los datos <code>x</code> e <code>y</code> como líneas, las clasifica de acuerdo al <code>color</code> y <code>size</code> determina el grosor de sus líneas.</p>
</li>
<li>
<p><strong><code>theme(legend.position)</code></strong>: capa que modifica la posición de la leyenda dentro gráfico, con <code>legend.position</code>, esta puede adquirir valores de <code>top</code>, <code>left</code>, etc.</p>
</li>
<li>
<p><strong><code>labs(x, y, color, title, subtitle)</code></strong>: capa que pone los nombres a eje <code>x</code> y al eje <code>y</code>, además de poner el nombre encima de las leyendas con <code>color</code>, el nombre título y subtítulo con <code>title</code> y <code>subtitle</code> respectivamente.</p>
</li>
</ul>
<p><img alt="Importaciones de Bolivia 1991-2021" src="../../../images/blog/visualiza-tus-datos-en-r-con-ggplot-y-gganimate/Rplot.png"></p>
<h3>Gráfica Animada</h3>
<p>Ya teniendo nuestra nuestra gráfica estática, vamos a realizar algunas modificaciones para que se resalten los datos de nuestro interés.</p>
<p>Filtrando datos con fecha mayor al año 2019.</p>
<pre class="code literal-block"><span></span><code><span class="n">datos</span> <span class="o">&lt;-</span> <span class="nf">filter</span><span class="p">(</span><span class="n">datos</span><span class="p">,</span> <span class="n">datos</span><span class="o">$</span><span class="n">Fecha</span> <span class="o">&gt;=</span> <span class="nf">as.Date</span><span class="p">(</span><span class="s">"2019-01-01"</span><span class="p">))</span>
</code></pre>

<ul>
<li>
<p><strong><code>filter(datos, condicion)</code></strong>: evalua cada fila de <code>datos</code> y filtra de acuerdo a la <code>condicion</code>.</p>
</li>
<li>
<p><code>as.Date(var)</code> convierte <code>var</code> a un formato de fecha <code>IDate</code></p>
</li>
</ul>
<p>Agregando un nuevo data frame periodos para resaltar las fechas de confinamiento por Covid19.</p>
<pre class="code literal-block"><span></span><code><span class="n">periodos</span> <span class="o">&lt;-</span>
  <span class="nf">data.frame</span><span class="p">(</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="nf">as.Date</span><span class="p">(</span><span class="s">"2020-03-22"</span><span class="p">),</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="nf">as.Date</span><span class="p">(</span><span class="s">"2020-08-31"</span><span class="p">),</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="o">-</span><span class="kc">Inf</span><span class="p">,</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="kc">Inf</span><span class="p">,</span>
    <span class="n">Periodo</span> <span class="o">=</span> <span class="s">"Confinamiento por COVID19"</span>
  <span class="p">)</span>
</code></pre>

<p>Creando un nuevo objeto <code>ggplot2</code> p2 para incluir las nuevas modificaciones.</p>
<pre class="code literal-block"><span></span><code><span class="n">p2</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">datos</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">Fecha</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Valor</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">Clasificacion</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_rect</span><span class="p">(</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">periodos</span><span class="p">,</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span>
    <span class="nf">aes</span><span class="p">(</span>
      <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
      <span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
      <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin</span><span class="p">,</span>
      <span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span><span class="p">,</span>
      <span class="n">fill</span> <span class="o">=</span> <span class="n">Periodo</span>
    <span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">"right"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">"Fecha"</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s">"Valor en MM Bs"</span><span class="p">,</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s">""</span> <span class="p">,</span>
    <span class="n">fill</span> <span class="o">=</span> <span class="s">""</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">"Datos de Importación Bolivia 2019-2021p"</span><span class="p">,</span>
    <span class="n">subtitle</span> <span class="o">=</span> <span class="s">"Expresado en Millones de Bolivianos"</span>
  <span class="p">)</span>
<span class="n">p2</span>
</code></pre>

<ul>
<li>
<p><strong><code>geom_rect(data, alpha, aes(xmin, xmax, ymin, ymax, fill))</code></strong>: dibuja un rectangulo a partir de los datos en <code>Data</code>,
  modifica su opacidad de acuerdo a <code>alpha</code>,
  extrae los datos de acuerdo a <code>xmin, xmax, ymin, ymax</code>,
  y los clasifica de acuerdo a <code>fill</code>.</p>
</li>
<li>
<p><strong><code>lab(fill)</code></strong>: pone el nombre encima de la leyenda de los datos clasificados con <code>fill</code>.</p>
</li>
</ul>
<p>Con las modificaciones ya hechas en p2, creamos el objeto <code>gganimate</code> llamado <code>anim</code> el cuál contendrá nuestra grafico a animar.</p>
<pre class="code literal-block"><span></span><code><span class="n">anim</span> <span class="o">&lt;-</span> <span class="n">p2</span> <span class="o">+</span> <span class="nf">transition_reveal</span><span class="p">(</span><span class="n">Fecha</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_label</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nf">as.Date</span><span class="p">(</span><span class="s">"2019-06-01"</span><span class="p">),</span>
    <span class="n">y</span> <span class="o">=</span> <span class="m">280</span><span class="p">,</span>
    <span class="n">label</span> <span class="o">=</span> <span class="nf">format</span><span class="p">(</span><span class="n">datos</span><span class="o">$</span><span class="n">Fecha</span><span class="p">,</span> <span class="s">"%Y"</span><span class="p">)</span>
  <span class="p">),</span>
  <span class="n">col</span> <span class="o">=</span> <span class="s">"gray"</span><span class="p">,</span>
  <span class="n">size</span> <span class="o">=</span> <span class="m">15</span><span class="p">)</span>
</code></pre>

<ul>
<li>
<p><strong><code>transition_reveal(var)</code></strong>: añade la capa de animacion del tipo transición usando como referencia la variable <code>var</code>.</p>
</li>
<li>
<p><strong><code>geom_label((aes(x,y,label)) col, size)</code></strong>:
  añade la capa de etiquetas del año dentro de la gráfica, con <code>aes(x, y, label)</code>: <code>x</code> e <code>y</code> son las coordenadas donde se grafica la etiqueta <code>label</code>, con <code>col</code> seleccionamos un color y con <code>size</code> el tamaño.</p>
</li>
</ul>
<p><em>Nota: geom_label() fué diseñado para graficar etiquetas que acompañen a la gráfica. En este ejemplo en específico fué usado como una etiqueta estática fijando sus coordenadas <code>x</code> e <code>y</code> en un sólo punto. Se optó por esta opción ya que genera un buen impacto visual.</em></p>
<p>Con el objeto <code>anim</code> creado podemos invocar la función <code>animate()</code> de <code>gganimate</code>. Una vez ejecutada la función se abrirá una ventana con el resultado en formato .gif.</p>
<pre class="code literal-block"><span></span><code><span class="nf">animate</span><span class="p">(</span>
  <span class="n">anim</span><span class="p">,</span>
  <span class="n">fps</span> <span class="o">=</span> <span class="m">25</span><span class="p">,</span>
  <span class="n">duration</span> <span class="o">=</span> <span class="m">15</span><span class="p">,</span>
  <span class="n">width</span> <span class="o">=</span> <span class="m">800</span><span class="p">,</span>
  <span class="n">height</span> <span class="o">=</span> <span class="m">500</span><span class="p">,</span>
  <span class="n">end_pause</span> <span class="o">=</span> <span class="m">30</span>
<span class="p">)</span>
</code></pre>

<ul>
<li>
<strong><code>animate(anim, fps, duration, width, height, end_pause)</code></strong>: <code>animate()</code> funcion para generar la animación, <code>anim</code> objeto a animarse,
  <code>fps</code> cantidad de frames por segundo,
  <code>duration</code> duración de la animación en segundos,
  <code>with</code>, <code>height</code> ancho y alto de la animación respectivamente en pixeles,
  <code>end_pause</code> cantidad de veces a repetirse el último frame para la animación.</li>
</ul>
<p>Hay casos en los que extrañamente no se instalan los renders para hacer la renderización de la animación y aparece un error al tratar de ejecutar el código arriba mostrado, en ese caso puede probar con la siguiente solución: Ejecute en modo administrador RStudio e instale los renders con <code>install.packages("gifski")</code> para el render que viene por defecto con <code>gganimate</code>, tambien puede instalar el render magick con <code>install.packages("magick")</code> para tener otra opción para renderizar. Para saber que opciones tiene el render magick ejecute <code>help("magick_renderer")</code> y se le mostrara su breve manual.</p>
<p><img alt="Importaciones de Bolivia durante la pandemia" src="../../../images/blog/visualiza-tus-datos-en-r-con-ggplot-y-gganimate/datosimportpandemia.gif"></p>
<p>Despues de ver la animación podemos guardarla haciendo:</p>
<pre class="code literal-block"><span></span><code><span class="n">archivo</span> <span class="o">&lt;-</span>
  <span class="nf">animate</span><span class="p">(</span>
    <span class="n">anim</span><span class="p">,</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="m">25</span><span class="p">,</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="m">15</span><span class="p">,</span>
    <span class="n">width</span> <span class="o">=</span> <span class="m">800</span><span class="p">,</span>
    <span class="n">height</span> <span class="o">=</span> <span class="m">500</span><span class="p">,</span>
    <span class="n">end_pause</span> <span class="o">=</span> <span class="m">30</span>
  <span class="p">)</span>

<span class="nf">anim_save</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s">"datosimportpandemia.gif"</span><span class="p">,</span>
          <span class="n">animation</span> <span class="o">=</span> <span class="n">archivo</span><span class="p">,</span>
          <span class="n">path</span> <span class="o">=</span> <span class="s">".my/path/save/"</span><span class="p">)</span>
</code></pre>

<p><strong><code>anim_save(filename, animation, path)</code></strong>:
guarda el renderizado de <code>animation</code> con el nombre <code>filename</code> en la ruta <code>path</code>.</p>
<h3>Referencias</h3>
<ul>
<li>
<a href="https://www.ine.gob.bo">Instituto Nacional de Estadística Bolivia</a> </li>
<li><a href="https://www.rdocumentation.org">Documentacion de R</a></li>
</ul>
<hr>
</div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../../0058-nfts-article1/nft-mas-que-un-jpg/" rel="prev" title="NFT. Más que un JPG">Publicación anterior</a>
            </li>

            <li class="archive">
                <a href="../../../archive.html" rel="archive" title="Archive ">Archivo</a>
            </li>

            <li class="next">
                <a href="../../0001-ciencia_abierta/que-es-la-ciencia-abierta/" rel="next" title="¿Qué es la ciencia abierta?">Siguiente publicación</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comentarios</h2>
        
    
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="nikolademo",
            disqus_url="https://opensciencelabs.org/blog/0057-r-ggplot-bo/visualiza-tus-datos-en-r-con-ggplot-y-gganimate/",
        disqus_title="Visualiza tus datos en R con ggplot2 y gganimate",
        disqus_identifier="cache/pages/blog/0057-r-ggplot-bo/ArticuloGgplotenR.html",
        disqus_config = function () {
            this.language = "es_ES";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="nikolademo";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2022         <a href="../../../team">Open Science Labs Team</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
