<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dibuja tus mapas en R usando archivos de formato Shapefile | Open Science Labs</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="es" href="../../../rss.xml">
<link rel="canonical" href="https://opensciencelabs.org/blog/0059-r-maps-viz/dibuja-tus-mapas-en-r-usando-archivos-de-formato-shapefile/">
<link rel="icon" href="../../../images/favicon.ico" sizes="16x16">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-213158050-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-213158050-1');
</script><link rel="stylesheet" type="text/css" href="../../../assets/css/tipuesearch.css">
<meta name="author" content="Ever Vino">
<meta property="description" content="Este breve tutorial te mostrará como graficar mapas en R, extaer datos de archivos de formato shapefile, resaltar puntos en tu mapa y modificar su apariencia utilizando las bibliotecas rgdal y ggplot2">
<link rel="next" href="../../0058-nfts-article1/nft-mas-que-un-jpg/" title="NFT. Más que un JPG" type="text/html">
<link rel="stylesheet" href="https://use.fontawesome.com/aa402b3835.css">
<meta property="og:site_name" content="Open Science Labs">
<meta property="og:title" content="Dibuja tus mapas en R usando archivos de formato Shapefile">
<meta property="og:url" content="https://opensciencelabs.org/blog/0059-r-maps-viz/dibuja-tus-mapas-en-r-usando-archivos-de-formato-shapefile/">
<meta property="og:description" content="Este breve tutorial te mostrará como graficar mapas en R, extaer datos de archivos de formato shapefile, resaltar puntos en tu mapa y modificar su apariencia utilizando las bibliotecas rgdal y ggplot2">
<meta property="og:image" content="https://opensciencelabs.org/images/logo.jpg">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-04-08T00:00:00-05:00">
<meta property="article:tag" content="maps">
<meta property="article:tag" content="r">
<meta property="article:tag" content="visualization">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@opensciencelabs">
<meta property="twitter:image" content="https://opensciencelabs.org/images/logo.jpg">
<link rel="stylesheet" href="../../../assets/css/osl.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../../">
            <img src="../../../images/logo.png" alt="Open Science Labs" id="logo" class="d-inline-block align-top"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../../" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="../../" class="nav-link">Blog</a>
                </li>
<li class="nav-item">
<a href="../../../guidelines/list" class="nav-link">Guidelines</a>
                </li>
<li class="nav-item">
<a href="../../../team/" class="nav-link">Team</a>
                </li>
<li class="nav-item">
<a href="../../../partners/" class="nav-link">Partners</a>
                </li>
<li class="nav-item">
<a href="../../../about/" class="nav-link">About</a>

                
            </li>
</ul>
<form class="navbar-form navbar-left" action="../../../search" role="search">
    <div class="form-group">
        <input type="text" class="form-control" id="tipue_search_input" name="q" placeholder="Search…" autocomplete="off">
</div>
    <input type="submit" value="Local Search" style="visibility: hidden;"><!-- button type="submit" class="btn btn-default">Submit</button -->
</form>


            <ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name">
                <a href="." class="u-url">Dibuja tus mapas en R usando archivos de formato Shapefile</a>
            </h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                         <a class="u-url" href="../../../authors/ever-vino/">Ever Vino</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-04-08T00:00:00-05:00" itemprop="datePublished" title="2019-04-08">2019-04-08</time></a>
            </p>
                <p class="commentline">
    
    <a href="#disqus_thread" data-disqus-identifier="cache/pages/blog/0059-r-maps-viz/GraficaMapasR.html">Comentarios</a>


            

        </p>
</div>
        
        <ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/maps/" rel="tag">maps</a></li>
            <li><a class="tag p-category" href="../../../categories/r/" rel="tag">r</a></li>
            <li><a class="tag p-category" href="../../../categories/visualization/" rel="tag">visualization</a></li>
        </ul></header><div class="e-content entry-content" itemprop="articleBody text">
        <!-- # Dibuja tus mapas en R usando archivos de formato Shapefile -->
<!-- **Autor**: [Ever Vino](https://opensciencelabs.github.io/articles/authors/ever-vino.html) -->

<p><img alt="header" src="../../../images/blog/dibuja-tus-mapas-en-r-usando-archivos-de-formato-shapefile/header.png"></p>
<p>Este breve tutorial te mostrará como graficar mapas en R, extaer datos de archivos de formato shapefile, resaltar puntos en tu mapa y modificar su apariencia utilizando las bibliotecas <code>rgdal</code> y <code>ggplot2</code>.</p>
<!-- TEASER_END -->

<h3>Comenzando</h3>
<p>Para que todas las bibliotecas funcionen correctamente, se recomienda instalar o actualizar a las últimas versiones de <a href="https://cran.r-project.org/">R</a> y de su IDE <a href="https://www.rstudio.com/">RStudio</a> con su correspondiente complemento <a href="https://cran.r-project.org/bin/windows/Rtools/rtools40.html">RTools</a>.</p>
<p>En este artículo, vamos a utilizar archivos de formato Shapefile. Si todavía no sabes de qué se trata, te explicamos a continuación.</p>
<p>Un archivo Shapefile contiene al menos:</p>
<ul>
<li>
<code>.shp</code> - un archivo tipo shape, es la geometría misma.</li>
<li>
<code>.shx</code> - un archivo tipo index, tiene las posiciones indexadas del archivo .shp.</li>
<li>
<code>.dbf</code> - un archivo tipo attribute, tiene los atributos de cada forma en una columna, es de tipo dBase IV.</li>
</ul>
<p>Adicionalmente, la carpeta donde se encuentran dichos archivos pueden contener otros archivos de formato <code>.prj</code> o <code>.sbn</code>, estos aportan más datos de la geometría o pueden ser usados en otros programas de sistemas de información geógrafica.</p>
<p>Los datos importados con <code>rgdal</code> a partir de un archivo shapefile, son objetos que contienen polígonos vectoriales, con las coordenadas la latitud y la longitud en formato decimal. A partir de estos objetos, podemos extraer datos para graficarlos desde una tabla. La biblioteca <code>broom</code> nos ayuda en la extracción y agrupa los datos para su correspondientes graficación.</p>
<p><strong>Obteniendo nuestros archivos shapefile</strong>
Muchos de estos archivos Shapefile representan mapas de nuestros Estados, por lo que están disponibles de manera gratuita en la mayoria de los casos, en otros, son de paga o están más completos, actualizados y/o poseen datos específicos. Debajo mostramos algunos recursos web gratuitos que puedes usar.</p>
<p><a href="https://data.humdata.org/">data.humdata.org</a> para shapefiles varios países del mundo. (Algunos están desactualizados)</p>
<p><a href="https://geo.gob.bo/geonetwork/srv/spa/catalog.search#/home">geo.gob.bo</a> para shapefiles de Bolivia</p>
<h4>Instalación de pre-requisitos</h4>
<p>Las siguientes bibliotecas de R son necesarias, para realizar nuestro ejemplo.</p>
<pre class="code literal-block"><span></span><code><span class="nf">install.packages</span><span class="p">(</span><span class="s">"ggplot2"</span><span class="p">)</span>    <span class="c1"># biblioteca para graficar.</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">"rgdal"</span><span class="p">)</span>      <span class="c1"># biblioteca para abrir archivo de formato shapefiles (datos geográficos)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">"broom"</span><span class="p">)</span>      <span class="c1"># biblioteca usada para extraer datos del archivo importado de shapefiles</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">"tidyverse"</span><span class="p">)</span>  <span class="c1"># biblioteca usada para unir tablas</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">"rio"</span><span class="p">)</span>        <span class="c1"># biblioteca para importar datos de archivos csv</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">"dplyr"</span><span class="p">)</span>     <span class="c1"># biblioteca usada para agrupar por valores de columnas</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">"extrafont"</span><span class="p">)</span> <span class="c1"># biblioteca para importar los tipos de letra de windows.</span>
</code></pre>

<p><em>(Recuerde que para ejecutar una linea de Comando en el Editor de RStudio se usa Ctrl+Enter)</em></p>
<h3>Preparación de los datos para graficar</h3>
<p>Nuestra base de datos fué descargada de <a href="https://geo.gob.bo">GeoBolivia</a>, <a href="https://www.ine.gob.bo/">INE Bolivia</a> y <a href="https://www.geodatos.net/coordenadas/bolivia">geodatos.net</a>. Una vez descargado los datos estos fueron depurados para el ejemplo.</p>
<p>Abrimos nuestras bibliotecas requeridas:</p>
<pre class="code literal-block"><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">rio</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">extrafont</span><span class="p">)</span>
</code></pre>

<p>Redireccionamos el directorio actual, a nuestro directorio de trabajo e importamos nuestros archivos shapefiles:</p>
<pre class="code literal-block"><span></span><code><span class="nf">setwd</span><span class="p">(</span><span class="s">"../mypath/"</span><span class="p">)</span> <span class="c1"># redirecciona el directo actual a nuestro directorio de trabajo</span>
<span class="c1"># importamos los datos geofgráficos a nuestra varibales shapefile</span>
<span class="n">shapefile</span> <span class="o">=</span> <span class="nf">readOGR</span><span class="p">(</span>
  <span class="n">dsn</span> <span class="o">=</span> <span class="s">"."</span><span class="p">,</span>
  <span class="n">layer</span> <span class="o">=</span> <span class="s">"departamentos_geo"</span><span class="p">,</span>
  <span class="n">encoding</span> <span class="o">=</span> <span class="s">'utf-8'</span><span class="p">,</span>
  <span class="n">use_iconv</span> <span class="o">=</span> <span class="kc">TRUE</span>
<span class="p">)</span> 
</code></pre>

<ul>
<li>
<p><strong><code>dsn</code></strong>: carpeta dentro del directorio actual, donde se encuentran ficheros shapefiles, si se pone sólo un punto <strong>"."</strong> hace referencia a que los ficheros se encuentran en la carpeta actual.</p>
</li>
<li>
<p><strong><code>encoding="utf-8", use_iconv=TRUE</code></strong>: indica a la función <code>readOGR</code> que debe importarse con la codificación <code>utf-8</code>. Siendo que nuestro archivo contiene caracteres del español como <strong>ñ</strong> y vocales con tildes, nos es conveniente usar este comando.</p>
</li>
</ul>
<p>Para observar el contenido de <code>shapefile</code>, use <code>View(shapefile)</code>.</p>
<p>Extraemos datos en <code>geotable</code> y a continuación mostramos su cabecera:</p>
<pre class="code literal-block"><span></span><code><span class="n">geotable</span> <span class="o">=</span> <span class="nf">tidy</span><span class="p">(</span><span class="n">shapefile</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">geotable</span><span class="p">)</span>
</code></pre>

<pre class="code literal-block"><span></span><code><span class="o">&gt;</span> <span class="nf">head</span><span class="p">(</span><span class="n">geotable</span><span class="p">)</span>
<span class="c1"># A tibble: 6 x 7</span>
   <span class="n">long</span>   <span class="n">lat</span> <span class="n">order</span> <span class="n">hole</span>  <span class="n">piece</span> <span class="n">group</span> <span class="n">id</span>   
  <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">int</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">lgl</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">fct</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">fct</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span>
<span class="m">1</span> <span class="m">-65.8</span> <span class="m">-18.0</span>     <span class="m">1</span> <span class="kc">FALSE</span> <span class="m">1</span>     <span class="m">0.1</span>   <span class="m">0</span>    
<span class="m">2</span> <span class="m">-65.8</span> <span class="m">-18.0</span>     <span class="m">2</span> <span class="kc">FALSE</span> <span class="m">1</span>     <span class="m">0.1</span>   <span class="m">0</span>    
<span class="m">3</span> <span class="m">-65.8</span> <span class="m">-18.0</span>     <span class="m">3</span> <span class="kc">FALSE</span> <span class="m">1</span>     <span class="m">0.1</span>   <span class="m">0</span>    
<span class="m">4</span> <span class="m">-65.8</span> <span class="m">-18.0</span>     <span class="m">4</span> <span class="kc">FALSE</span> <span class="m">1</span>     <span class="m">0.1</span>   <span class="m">0</span>    
<span class="m">5</span> <span class="m">-65.8</span> <span class="m">-18.0</span>     <span class="m">5</span> <span class="kc">FALSE</span> <span class="m">1</span>     <span class="m">0.1</span>   <span class="m">0</span>    
<span class="m">6</span> <span class="m">-65.8</span> <span class="m">-18.0</span>     <span class="m">6</span> <span class="kc">FALSE</span> <span class="m">1</span>     <span class="m">0.1</span>   <span class="m">0</span>    
</code></pre>

<p>Nótese que geotable, no poseé las etiquetas de los nombres de las regiones a graficar, esto lo arreglamos con:</p>
<pre class="code literal-block"><span></span><code><span class="c1"># añadiendo una columna id para poder juntar las columnas de nuestro geotable</span>
<span class="n">shapefile</span><span class="o">$</span><span class="n">id</span> <span class="o">&lt;-</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">shapefile</span><span class="p">)</span>

<span class="c1"># añadiendo a geotable los datos que faltan desde shapefile y juntandolo por el id</span>
<span class="n">geotable</span> <span class="o">&lt;-</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">geotable</span><span class="p">,</span> <span class="n">shapefile</span><span class="o">@</span><span class="n">data</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">"id"</span><span class="p">)</span>
</code></pre>

<p>Para verificar que se han añadido los correspondientes nombres de regiones, use<code>head(geotable)</code></p>
<p>Funciones auxiliares:</p>
<ul>
<li>
<strong><code>shapefile$id &lt;-</code></strong>: crea una nueva columna <code>id</code> en shapefile o la reemplaza.</li>
<li>
<strong><code>row.names(shapefile)</code></strong>: extrae los nombres de las filas del shapefile que por defecto es una numeración que va desde 0 y coincide con el <code>id</code> de nuestro <code>geotable</code>.</li>
<li>
<strong><code>shapefile@data</code></strong> accede a la tabla o dataframe <code>data</code> de nuestro shapefile.</li>
<li>
<strong><code>left_join(tabla1, tabla2, by = clave)</code></strong>:  junta dos tablas por izquierda, es decir añade valores que faltan de <code>tabla2</code> a la <code>tabla1</code> de acuerdo al código <code>clave</code> o columna común.</li>
</ul>
<p>Ahora importamos nuestra tabla con los datos de población por departamento: (haciendo <code>header = TRUE</code> nos aseguramos que la primera fila se conviertan en los nombres de las columnas)</p>
<pre class="code literal-block"><span></span><code><span class="c1"># importando la tabla de datos de población</span>
<span class="n">poblacion</span> <span class="o">&lt;-</span> <span class="nf">import</span><span class="p">(</span><span class="s">"departamentospoblacion.csv"</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</code></pre>

<p>Nótese que cambiamos el nombre nuestra columna de en población <code>DEPARTAMENTO</code> por <code>DEPARTAMEN</code>, para que coincidan nuestra columnas y luego juntarlas con <code>left_join()</code>.</p>
<pre class="code literal-block"><span></span><code><span class="c1"># cambiando el nombre de la columna de DEPARTAMENTO POR DEPARTAMEN</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">poblacion</span><span class="p">)[</span><span class="nf">colnames</span><span class="p">(</span><span class="n">poblacion</span><span class="p">)</span> <span class="o">==</span> <span class="s">"DEPARTAMENTO"</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">"DEPARTAMEN"</span>
<span class="c1"># juntamos en datos ambas tablas</span>
<span class="n">datos</span><span class="o">&lt;-</span><span class="nf">left_join</span><span class="p">(</span><span class="n">geotable</span><span class="p">,</span> <span class="n">poblacion</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">"DEPARTAMEN"</span><span class="p">)</span>
</code></pre>

<h3>Graficando el mapa con ggplot2</h3>
<p>Ahora, graficamos con <code>ggplot2</code>:</p>
<pre class="code literal-block"><span></span><code><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">geom_polygon</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">datos</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">,</span>
    <span class="n">fill</span> <span class="o">=</span> <span class="n">Poblacion2022</span>
  <span class="p">))</span> <span class="o">+</span>
  <span class="nf">coord_equal</span><span class="p">()</span> <span class="o">+</span> <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">"POBLACION"</span><span class="p">)</span>
</code></pre>

<ul>
<li>
<strong><code>geom_polygon(data, aes(x, y, group, fill))</code></strong>: dibuja polígonos con la tabla <code>data</code> y muestra la estética con <code>aes()</code>.
  <code>x</code>, <code>y</code> son los valores en ejes de las absisas y las ordenadas, estan agrupadas por el valor de la columna <code>group</code> y se colorea con base a los valores de la columna <code>fill</code>.</li>
<li>
<strong><code>coord_equal()</code></strong>: obliga a la gráfica que la relación de aspecto entre coordenadas sea 1:1.</li>
<li>
<strong><code>lab(fill)</code></strong>: pone el título a la leyenda con <code>fill</code>.</li>
</ul>
<p><img alt="Mapa de Bolivia: Población por departamento" src="../../../images/blog/dibuja-tus-mapas-en-r-usando-archivos-de-formato-shapefile/grafica1.png"></p>
<h3>Mejorando la presentación de nuestro mapa</h3>
<p>Entre las cosas que podemos hacer para mejorar la apariencia de nuestra gráfica, están poner un título, cambiar los colores, el fondo, el formato de nuestra leyenda. A continuación mostramos como hacerlos.</p>
<p>Extraemos los valores de la población, para ponerlas como etiquetas dentro de nuestro mapa, para ello utilizamos las funciones <code>group_by()</code> y <code>summarise()</code> de la biblioteca <code>dplyr</code>.</p>
<pre class="code literal-block"><span></span><code><span class="n">etiquetas_poblacion</span> <span class="o">&lt;-</span> <span class="n">datos</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">DEPARTAMEN</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarise</span><span class="p">(</span>
    <span class="n">label_long</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="n">long</span><span class="p">)),</span>
    <span class="n">label_lat</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="n">lat</span><span class="p">)),</span>
    <span class="n">pob</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">Poblacion2022</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre>

<ul>
<li>
<strong><code>tabla0 %&gt;% funcion0 %&gt;% funcion1 ...</code></strong>: Esta notación indica que se debe tomar la <code>tabla0</code> como argumento de la <code>funcion0</code>, luego los resultados de la <code>funcion0</code> deben tomarse como argumentos de la <code>función1</code> y así sucesivamente. El símbolo <strong>%&gt;%</strong> es conocido como <code>pipe operator</code> este nos ayuda para concatenar valores de entrada y salida de diferentes funciones.</li>
<li>
<strong><code>group_by(col) %&gt;% summarise(col1=accion1, col2=accion2 ...)</code></strong>: agrupa los datos en función del valor de columna <code>col</code> y con <code>summarise()</code> usa los datos agrupados para devolver nuevos valores: <code>col1</code>, <code>col2</code> ..., que pueden estar en función de los valores que están agrupados.</li>
<li>
<strong><code>range(v)</code></strong>: extrae los valores máximo y mínimo de un rango de datos <code>v</code>.</li>
<li>
<strong><code>mean(v)</code></strong>: devuelve el valor medio del vector <code>v</code>.</li>
</ul>
<p>Si, queremos incluir nuevas fuentes para el tipo de letra para nuestro mapa, empleamos los siguientes comandos:
(Nota: nos pedirá confirmación para realizar la importación de fuentes y tardará unos minutos):</p>
<pre class="code literal-block"><span></span><code><span class="n">extrafont</span><span class="o">::</span><span class="nf">font_import</span><span class="p">(</span><span class="s">"C:/Windows/Fonts"</span><span class="p">)</span>
<span class="nf">loadfonts</span><span class="p">(</span><span class="n">device</span> <span class="o">=</span> <span class="s">"win"</span><span class="p">)</span>
<span class="nf">fonts</span><span class="p">()</span> <span class="c1"># Nos muestra las fuentes disponibles.</span>
</code></pre>

<p>Incluimos los datos de <code>etiquetas_población</code> en nuestra gráfica.</p>
<pre class="code literal-block"><span></span><code><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">geom_polygon</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">datos</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">,</span>
    <span class="n">fill</span> <span class="o">=</span> <span class="n">Poblacion2022</span>
  <span class="p">))</span> <span class="o">+</span>
  <span class="nf">coord_equal</span><span class="p">()</span> <span class="o">+</span> <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">geom_text</span><span class="p">(</span>
    <span class="n">size</span> <span class="o">=</span> <span class="m">4.5</span><span class="p">,</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.9</span><span class="p">,</span>
    <span class="n">fontface</span> <span class="o">=</span> <span class="s">"bold"</span><span class="p">,</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">etiquetas_poblacion</span><span class="p">,</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">label_long</span><span class="p">,</span>
      <span class="n">y</span> <span class="o">=</span> <span class="n">label_lat</span><span class="p">,</span>
      <span class="n">label</span> <span class="o">=</span> <span class="nf">format</span><span class="p">(</span><span class="n">pob</span><span class="p">,</span> <span class="n">big.mark</span> <span class="o">=</span> <span class="s">" "</span><span class="p">),</span>
      <span class="n">color</span> <span class="o">=</span> <span class="n">pob</span>
    <span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Población estimada de Bolivia por departamentos para el año 2022"</span><span class="p">,</span>
       <span class="n">fill</span> <span class="o">=</span> <span class="s">"Habitantes"</span><span class="p">,</span>
       <span class="n">caption</span> <span class="o">=</span> <span class="s">"Datos:INE Boliva; GeoDatos: GeoBolivia"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_colour_gradientn</span><span class="p">(</span><span class="n">colours</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">"black"</span><span class="p">,</span> <span class="s">"black"</span><span class="p">,</span> <span class="s">"white"</span><span class="p">,</span> <span class="s">"white"</span><span class="p">,</span> <span class="s">"white"</span><span class="p">),</span>
                         <span class="n">guide</span> <span class="o">=</span> <span class="s">"none"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_fill_continuous</span><span class="p">(</span>
    <span class="n">low</span> <span class="o">=</span> <span class="s">"#C4FFD1"</span><span class="p">,</span>
    <span class="n">high</span> <span class="o">=</span> <span class="s">"#05693E"</span><span class="p">,</span>
    <span class="n">guide</span> <span class="o">=</span> <span class="s">"colorbar"</span><span class="p">,</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">label_number</span><span class="p">(</span><span class="n">big.mark</span> <span class="o">=</span> <span class="s">" "</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span>
    <span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span>
      <span class="n">size</span> <span class="o">=</span> <span class="m">14</span><span class="p">,</span>
      <span class="n">face</span> <span class="o">=</span> <span class="s">"bold"</span><span class="p">,</span>
      <span class="n">family</span> <span class="o">=</span> <span class="s">"Helvetica"</span><span class="p">,</span>
      <span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span>
    <span class="p">),</span>
    <span class="n">legend.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">12</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="s">"Rubik"</span><span class="p">),</span>
    <span class="n">plot.caption</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">family</span> <span class="o">=</span> <span class="s">"Helvetica"</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre>

<ul>
<li>
<strong><code>theme_void()</code></strong>: elimina el fondo y los ejes de nuestra gráfica.</li>
<li>
<strong><code>geom_text(size, alpha, fontface, data, mapping = aes(x, y, label), color)</code></strong>: extrae los datos de <code>data</code>, para graficar el texto <code>label</code> en las coordenadas <code>x</code> e <code>y</code>, si, se desea una diferenciacion de colores usesé <code>color</code>. Con <code>size</code>, <code>alpha</code> y <code>fontface</code>, se establece el tamaño, la opacidad y la estetica del texto respectivamente.</li>
<li>
<strong><code>format(v, big.mark)</code></strong>: da el formato al valor <code>v</code>, indicando la separación de miles con <code>big.mark</code> (En nuestro ejemplo el separador de miles es sólo el espacio " ").</li>
<li>
<strong><code>labs(title, fill, caption)</code></strong>: con <code>title</code>, <code>fill</code>, <code>caption</code> pone el texto del título, la leyenda y el pie del gráfico respectivamente.</li>
<li>
<strong><code>scale_colour_gradientn(colours, guide)</code></strong>: aplica una escala de colores a todos los valores asignados a el argumento <code>color</code>, en nuestro ejemplo tenemos color dentro de la función  <code>geom_text(... aes(.. color = pob ...) ...)</code>, es decir los valores de <code>pob</code> estarán coloreados según los valores de <code>colours</code> (la sintaxis <code>color</code> <code>colors</code> pueden intercambiarse sin problema con <code>colour</code> y <code>colours</code>) y para que la guia de leyenda no se muestre usamos <code>guide = "none"</code>.</li>
<li>
<strong><code>scale_fill_continuous(low, high, guide, labels)</code></strong>: establece una escala de colores continua a los valores asignados a <code>fill</code>, en nuestro ejemplo <code>fill</code>, está dentro de la función <code>geom_polygon(... aes(... fill = Poblacion2022 ...) ...)</code>, es decir los valores de la columna <code>Poblacion2022</code> estaran afectados por esta función. Usamos <code>low</code> para el color correspondiente al valor más bajo y <code>high</code> para el color del valor más alto. Con <code>guide = colorbar</code> mostramos nuestra leyenda en forma de colobar y con<code>labels</code> modificamos la apariencia en la escala de nuestro colorbar.</li>
<li>
<strong><code>scales::label_number(big.mark=" ")</code></strong>: usa la función <code>label_number()</code>  de la biblioteca <code>scales</code>.
  Con esto modificamos la apariencia de los números de nuestra leyenda poniéndole un espacio <strong>" "</strong> como separador de miles.
  (Nótese que podemos usar <code>scales::funcion()</code> en vez de <code>library(scales) funcion())</code>.</li>
<li>
<strong><code>theme(plot.title, legend.title, plot.caption)</code></strong>: modifica la apariencia del título del gráfico, el título de la leyenda y el pie de gráfico respectivamente.</li>
<li>
<strong><code>element_text(size, face, family, hjust)</code></strong>: extrae propiedades del texto para modificar el tamaño, la estética, el tipo y la posición en horizontal.</li>
</ul>
<p><img alt="Mapa de Bolivia: Población por departamento" src="../../../images/blog/dibuja-tus-mapas-en-r-usando-archivos-de-formato-shapefile/grafica2.png"></p>
<h3>Añadiendo ubicaciones a nuestro mapa</h3>
<p>Incluyendo las ubicaciones de ciudades capitales de departamento a nuestro mapa:</p>
<pre class="code literal-block"><span></span><code><span class="n">ciudades</span> <span class="o">=</span> <span class="nf">import</span><span class="p">(</span><span class="s">"ciudades.csv"</span><span class="p">)</span> <span class="c1"># importamos la localización de las ciudades capitales</span>

<span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">geom_polygon</span><span class="p">(</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">datos</span><span class="p">,</span>
    <span class="nf">aes</span><span class="p">(</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span>
      <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span>
      <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">,</span>
      <span class="n">fill</span> <span class="o">=</span> <span class="n">DEPARTAMEN</span>
    <span class="p">),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s">"gray"</span><span class="p">,</span>
    <span class="n">size</span> <span class="o">=</span> <span class="m">0.5</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">,</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ciudades</span><span class="p">,</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">Ciudad</span><span class="p">),</span>
    <span class="n">size</span> <span class="o">=</span> <span class="m">5</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">coord_equal</span><span class="p">()</span> <span class="o">+</span> <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Capitales de Departamento en Bolivia"</span><span class="p">,</span>
                       <span class="n">color</span> <span class="o">=</span> <span class="s">"Ciudades Capitales"</span><span class="p">,</span>
                       <span class="n">caption</span> <span class="o">=</span> <span class="s">"Fuente: geodatos.net, GeoBolivia"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">'PuBuGn'</span><span class="p">,</span> <span class="n">guide</span> <span class="o">=</span> <span class="s">"none"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_color_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="nf">rainbow</span><span class="p">(</span><span class="m">9</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span>
    <span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span>
      <span class="n">size</span> <span class="o">=</span> <span class="m">14</span><span class="p">,</span>
      <span class="n">face</span> <span class="o">=</span> <span class="s">"bold"</span><span class="p">,</span>
      <span class="n">family</span> <span class="o">=</span> <span class="s">"Helvetica"</span><span class="p">,</span>
      <span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span>
    <span class="p">),</span>
    <span class="n">legend.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">12</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="s">"Rubik"</span><span class="p">),</span>
    <span class="n">plot.caption</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">family</span> <span class="o">=</span> <span class="s">"Helvetica"</span><span class="p">)</span>
  <span class="p">)</span> 
</code></pre>

<ul>
<li>
<strong><code>geom_point(alpha, data, mapping = aes(x, y, colour), size)</code></strong>: dibuja puntos dentro del gráfico, comparte similares argumentos con <code>geom_poligon()</code> y <code>geom_text()</code>.</li>
<li>
<strong><code>scale_fill_brewer(palette, guide)</code></strong>: similar a la función <code>scale_fill_continuous(low, high, guide, labels)</code> aplica una escala de colores tipo brewer a todos los objetos asignados a <code>fill</code> y con <code>pallete</code> seleccionamos el tipo de paleta de colores a aplicarse.</li>
<li>
<strong><code>scale_color_manual(values)</code></strong>: nos permite usar una escala de colores manual, <code>values</code> debe ser un vector que contenga los valores de los colores de la escala.</li>
<li>*<strong><code>raibow(9)</code></strong>: devuelve un vector con 9 colores del arcoiris.</li>
</ul>
<p><img alt="Mapa de Bolivia: Capitales de departamento" src="../../../images/blog/dibuja-tus-mapas-en-r-usando-archivos-de-formato-shapefile/grafica3.png"></p>
<h5>Asignando colores</h5>
<p>Puedes asignar los colores simplemente usando su nombre en inglés. Para el blanco es <strong>white</strong>, para el rojo, <strong>red</strong>. También puedes utilizar el código hexadecimal, como  <strong>#FF4500</strong> para el rojo anaranjado; agruparlos en una escala de colores, utilizando el comando <code>c("red","#FF4500"...)</code>. Una página recomendable para seleccionar colores y obtener su código de color con un click es <a href="https://r-charts.com/colors/">r-chart.com/colors/</a>.
También puede emplear las funciones auxiliares que ofrece <code>R</code>, por ejemplo: <code>scale_color</code>/<code>fill_brewer</code>/<code>viridis_</code>. Estas proporcionan escalas predefinidas que podrían mejorar el impacto visual.</p>
<h3>Guardando nuestro mapa</h3>
<p>RStudio ofrece la posibilidad de exportar fácilmente desde su menú, ubicado encima de la vista previa del gráfico "Export". Podemos optar por guardar nuestro mapa con mayor calidad o cierto formato y, para ello, podemos usar <code>ggsave()</code>, que nos permite exportar o guardar nuestro último gráfico ejecutado.</p>
<pre class="code literal-block"><span></span><code><span class="nf">ggsave</span><span class="p">(</span>
  <span class="n">filename</span> <span class="o">=</span> <span class="s">"grafica.png"</span><span class="p">,</span>
  <span class="n">path</span> <span class="o">=</span> <span class="s">".../mypath/"</span><span class="p">,</span>
  <span class="n">scale</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
  <span class="n">device</span> <span class="o">=</span> <span class="s">"png"</span><span class="p">,</span>
  <span class="n">dpi</span> <span class="o">=</span> <span class="m">320</span>
<span class="p">)</span>
</code></pre>

<p>Guarda el mapa con el nombre <code>filename</code> en la ruta <code>path</code>, con la escala y formato de <code>scale</code> y <code>device</code>. Con <code>dpi</code> indicamos la cantidad de píxeles por pulgada, que es la calidad de nuestro archivo a exportar.</p>
<h3>Referencias</h3>
<ul>
<li><a href="https://www.ine.gob.bo">Instituto Nacional de Estadística Bolivia</a></li>
<li><a href="https://geo.gob.bo/">GeoBolivia</a></li>
<li><a href="https://www.geodatos.net/coordenadas/bolivia">geodatos.net</a></li>
<li><a href="https://github.com/Robinlovelace/Creating-maps-in-R">Robinlovelace</a></li>
<li><a href="https://www.rdocumentation.org">Documentacion de R</a></li>
</ul>
</div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous disabled">
                <a rel="prev">Publicación anterior</a>
            </li>

            <li class="archive">
                <a href="../../../archive.html" rel="archive" title="Archive ">Archivo</a>
            </li>

            <li class="next">
                <a href="../../0058-nfts-article1/nft-mas-que-un-jpg/" rel="next" title="NFT. Más que un JPG">Siguiente publicación</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comentarios</h2>
        
    
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="nikolademo",
            disqus_url="https://opensciencelabs.org/blog/0059-r-maps-viz/dibuja-tus-mapas-en-r-usando-archivos-de-formato-shapefile/",
        disqus_title="Dibuja tus mapas en R usando archivos de formato Shapefile",
        disqus_identifier="cache/pages/blog/0059-r-maps-viz/GraficaMapasR.html",
        disqus_config = function () {
            this.language = "es_ES";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="nikolademo";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2022         <a href="../../../team">Open Science Labs Team</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
